---
import type { AstroComponentFactory } from 'astro/runtime/server';
import BaseLayout from './BaseLayout.astro';
import CTAButton from '../components/CTAButton.astro';
import type { ProjectMeta } from '../data/projects';

const { Content, meta } = Astro.props as {
  Content: AstroComponentFactory | null;
  meta: ProjectMeta;
};

const title = meta.title ?? 'Project overview';
const summary = meta.summary ?? 'Project details coming soon.';
const role = meta.role ?? 'Contributor';
const tech = Array.isArray(meta.tech) ? meta.tech : [];
const tags = Array.isArray(meta.tags) ? meta.tags : [];
const outcomes = Array.isArray(meta.outcomes) ? meta.outcomes : [];
const github = meta.github ?? '';
---

<BaseLayout title={title} description={summary}>
  <article class="space-y-10">
    <section class="grid gap-8 md:grid-cols-[2fr,1fr]">
      <div class="space-y-4">
        <div class="flex flex-wrap gap-2 text-xs uppercase tracking-[0.3em] text-[color:var(--color-accent)]">
          {tags.length > 0 ? (
            tags.map((tag) => (
              <span class="rounded-full border border-[color:var(--color-border)] px-3 py-1">{tag}</span>
            ))
          ) : (
            <span class="rounded-full border border-[color:var(--color-border)] px-3 py-1">Case Study</span>
          )}
        </div>
        <p class="text-[color:var(--color-text-muted)]">{summary}</p>
      </div>
      <aside class="space-y-4 rounded-2xl border border-[color:var(--color-border)] bg-[color:var(--color-surface)] p-5">
        <dl class="space-y-2 text-sm text-[color:var(--color-text-muted)]">
          <div>
            <dt class="font-semibold text-[color:var(--color-text)]">Role</dt>
            <dd>{role}</dd>
          </div>
          <div>
            <dt class="font-semibold text-[color:var(--color-text)]">Tech</dt>
            <dd class="flex flex-wrap gap-2">
              {tech.length > 0 ? (
                tech.map((item) => (
                  <span class="rounded-full border border-[color:var(--color-border)] px-2 py-1 text-xs uppercase tracking-wide text-[color:var(--color-text-muted)]">
                    {item}
                  </span>
                ))
              ) : (
                <span class="rounded-full border border-[color:var(--color-border)] px-2 py-1 text-xs uppercase tracking-wide text-[color:var(--color-text-muted)]">
                  Details coming soon
                </span>
              )}
            </dd>
          </div>
        </dl>
        {github ? (
          <CTAButton href={github} target="_blank" rel="noreferrer" variant="secondary">
            View on GitHub
          </CTAButton>
        ) : (
          <p class="text-xs text-[color:var(--color-text-muted)]">GitHub link coming soon.</p>
        )}
      </aside>
    </section>

    {outcomes.length > 0 && (
      <section class="space-y-3">
        <h2 class="text-2xl font-semibold text-[color:var(--color-text)]">Outcomes</h2>
        <ul class="list-disc space-y-2 pl-6 text-[color:var(--color-text-muted)]">
          {outcomes.map((item) => (
            <li>{item}</li>
          ))}
        </ul>
      </section>
    )}

    {Content ? (
      <section class="prose prose-invert max-w-none">
        <Content />
      </section>
    ) : (
      <section class="rounded-2xl border border-dashed border-[color:var(--color-border)] bg-[color:var(--color-surface-alt)] p-6 text-sm text-[color:var(--color-text-muted)]">
        Detailed write-up coming soon. In the meantime, explore the repository for implementation notes and code examples.
      </section>
    )}
  </article>
</BaseLayout>
